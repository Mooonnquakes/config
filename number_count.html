<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数数游戏</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: black;
      color: #fff;
      font-family: 'Courier New', Courier, monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .terminal {
      padding: 20px;
      background-color: #000;
      border: 2px solid #fff;
      border-radius: 5px;
      text-align: center;
      max-width: 800px;
      width: 90%;
    }
    .correct {
      color: green;
    }
    .incorrect {
      color: red;
    }
    .silver {
      color: #C0C0C0; /* brighter silver color */
    }
    /* CSS styles for gold and bronze remain unchanged */
    .gold {
      color: gold;
    }
    .bronze {
      color: #cd7f32; /* bronze color */
    }
    /* Styles for the leaderboard box */
    .leaderboard-box {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 10px;
      background-color: #000;
      color: #fff;
      border: 2px solid #999595;
      border-radius: 5px;
      width: auto;
      max-height: 300px;
      overflow-y: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #555;
    }
    tr:nth-child(even) {
      background-color: #444;
    }
    tr:hover {
      background-color: #666;
    }
  </style>
</head>
<body>
  <div id="app" class="terminal">
    <h1>数数游戏</h1>
    <div v-if="!gameStarted">
      <p>请输入难度（1-10的数字）：</p>
      <input v-model="difficulty" type="number" class="form-control" placeholder="输入数字1-10">
      <button @click="startGame" class="mt-3">开始游戏</button>
    </div>
    <div v-if="gameStarted && !gameEnded">
      <p>请数出数字 <strong>{{ selectedDigit }}</strong> 在下方数字中出现的次数：</p>
      <p class="h3">{{ randomNumber }}</p>
      <input v-model="userAnswer" type="number" class="form-control mt-3" placeholder="你的答案">
      <button @click="checkAnswer" class="mt-3">提交</button>
    </div>
    <div v-if="gameEnded">
      <p v-if="showResult && isCorrect">你的答案是 <strong :class="{ correct: true}">正确</strong>！</p>
      <p v-if="showResult && !isCorrect">你的答案是 <strong :class="{ incorrect: true}">错误</strong>！正确答案是：<strong :class="{ correct: true}">{{ countDigitOccurrences(selectedDigit) }}</strong></p>
      <p v-if="showResult">游戏结束！重新开始游戏倒数 <strong>{{ countdown }}</strong> 秒。</p>
    </div>

    <div class="leaderboard-box">
      <h3>排行榜</h3>
      <table :showPagination="false">
        <thead>
          <tr>
            <th>名次</th>
            <th>玩家ID</th>
            <th>游戏难度</th>
            <th>游戏时长</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(entry, index) in sortedLeaderboard" :key="index" :class="getMedalClass(index)">
            <td>{{ index + 1 }}</td>
            <td>{{ entry.playerId }}</td>
            <td>{{ entry.difficulty }}</td>
            <td>{{ entry.time.toFixed(2) }} 秒</td> <!-- Use toFixed(2) to display two decimal places -->
          </tr>
        </tbody>
      </table>
    </div>

    <script src="https://unpkg.com/vue@3.0.0/dist/vue.global.js"></script>
    <script>
      const app = Vue.createApp({
        computed: {
          sortedLeaderboard() {
            return this.leaderboard.slice().sort((a, b) => {
              if (a.difficulty === b.difficulty) {
                return a.time - b.time;
              } else {
                return b.difficulty - a.difficulty;
              }
            });
          },
        },
        data() {
          return {
            gameStarted: false,
            gameEnded: false,
            difficulty: '',
            randomNumber: '',
            selectedDigit: 0,
            userAnswer: null,
            showResult: false,
            isCorrect: false,
            countdown: 3,
            leaderboard: [],
          };
        },
        methods: {
          getMedalClass(index) {
            if (index === 0) {
              return 'gold';
            } else if (index === 1) {
              return 'silver';
            } else if (index === 2) {
              return 'bronze';
            } else {
              return '';
            }
          },
          startGame() {
            if (this.difficulty === '' || isNaN(this.difficulty) || parseInt(this.difficulty) < 1 || parseInt(this.difficulty) > 10) {
              alert('请输入有效的难度：1-10的数字');
              return;
            }

            const length = parseInt(this.difficulty) * 10;
            this.randomNumber = this.generateRandomNumber(length);
            this.selectedDigit = parseInt(this.randomNumber[Math.floor(Math.random() * this.randomNumber.length)]);
            this.gameStarted = true;
            this.showResult = false;
            this.userAnswer = null;
          },
          generateRandomNumber(length) {
            let num = '';
            for (let i = 0; i < length; i++) {
              num += Math.floor(Math.random() * 10);
            }
            return num;
          },
          checkAnswer() {
            this.showResult = true;
            const digitOccurrences = this.countDigitOccurrences(this.selectedDigit);

            // Convert the user's answer to a number
            const userAnswerAsNumber = parseInt(this.userAnswer);

            // Check if the user's answer matches the correct count of the selected digit
            this.isCorrect = userAnswerAsNumber === digitOccurrences;
            this.gameEnded = true;

            let count = 3;
            const countdownInterval = setInterval(() => {
              count--;
              this.countdown = count;
              if (count === 0) {
                clearInterval(countdownInterval);
                if (this.isCorrect) {
                  this.updateLeaderboard();
                }
                this.restartGame();
              }
            }, 1000);
          },
          countDigitOccurrences(digit) {
            return this.randomNumber.split(digit.toString()).length - 1;
          },
          restartGame() {
            this.gameStarted = false;
            this.gameEnded = false;
            this.difficulty = '';
            this.randomNumber = '';
            this.selectedDigit = 0;
            this.userAnswer = null;
            this.showResult = false;
            this.isCorrect = false;
            this.countdown = 3;
          },
          updateLeaderboard() {
            const entry = {
              playerId: this.generatePlayerId(),
              difficulty: this.difficulty,
              time: 3 - this.countdown,
            };

            this.leaderboard.push(entry);

            this.leaderboard.sort((a, b) => {
              if (a.difficulty === b.difficulty) {
                return a.time - b.time;
              } else {
                return b.difficulty - a.difficulty;
              }
            });

            if (this.leaderboard.length > 10) {
              this.leaderboard = this.leaderboard.slice(0, 10);
            }
          },
          generatePlayerId() {
            return Math.random().toString(36).substr(2, 9);
          },
        },
      });

      app.mount('#app');
    </script>
  </div>
</body>
</html>
